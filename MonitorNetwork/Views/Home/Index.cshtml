@model MonitorNetwork.Models.NetworkModel
@{
    ViewBag.Title = "Home Page";
}


<div id="cy" class="col-md-8 col-md-offset-3" style=" z-index: 0; overflow: hidden; width: 800px; height: 800px; "></div>


<div id="transactions">
    @Html.Partial("_TransactionPartial", Model.transactions)
</div>

<script>
    function sendTransaction(transactionId, storeId) {
        $.ajax({
            type: "GET",
            url: '/Home/Send?id=' + transactionId,
            dataType: 'html',
            success: function (data) {
                $('#transactions').html(data);
            }
        });

        moveTransaction(storeId);
    }
</script>

<script>

	var text = '{"connections":[' +
		'{"connID": "1", "storeID": "1", "relayID": "NULL", "destRelayID": "1", "weight": "2", "active": "True" },' +

		'{"connID": "2", "storeID": "2", "relayID": "NULL", "destRelayID": "1", "weight": "3", "active": "True" },' +

		'{"connID": "3", "storeID": "NULL", "relayID": "1", "destRelayID": "2", "weight": "1", "active": "False" },' +

		'{ "connID": "4", "storeID": "NULL", "relayID": "1", "destRelayID": "3", "weight": "4", "active": "True" },' +

		'{ "connID": "5", "storeID": "NULL", "relayID": "2", "destRelayID": "3", "weight": "1", "active": "True" }, ' +

		'{ "connID": "6", "storeID": "NULL", "relayID": "2", "destRelayID": "4", "weight": "3", "active": "True" },' +

		'{ "connID": "7", "storeID": "NULL", "relayID": "3", "destRelayID": "4", "weight": "1", "active": "True" } ]}'

        @{

            string stringify = Newtonsoft.Json.JsonConvert.SerializeObject(Model.connections);
        }
    obj = { "connections":@Html.Raw(stringify) }
    var list = [];

    function moveTransaction(startID) {
        var pathToMove = startPath(startID);
        highlightNextEle(pathToMove);
    }

	function startPath(s1) {
		storeToRelay(s1);
		//for (var i = 0; i < list.length; i++) {
		//	document.write(list[i] + " ");
		//}
		return list;
	}

	function storeToRelay(s1) {
		var next = obj.connections[0];

		if (next.storeID !== s1 || !next.active) {
			for (var i = 0; i < obj.connections.length; i++) {
				if (obj.connections[i].storeID === s1 && obj.connections[i].active) {
					next = obj.connections[i]
				}
			}
		}
		if (next.storeID === s1) {
			list.push("S" + s1);

		}
		else {
			console.log("Store does not exist!");

			return 0;
		}
		for (var i = 0; i < obj.connections.length; i++) {
			if (obj.connections[i].weight <= next.weight && obj.connections[i].storeID === s1) {
				next = obj.connections[i];

			}

		}
		list.push("R" + next.destRelayID);
		relayToRelay(next.destRelayID);
	}

	function relayToRelay(r1) {
		var next = obj.connections[0];

		if (next.relayID !== r1 || !next.active) {
			for (var i = 0; i < obj.connections.length; i++) {
				if (obj.connections[i].relayID === r1 && obj.connections[i].active) {
					next = obj.connections[i]
				}
			}
		}
		for (var i = 0; i < obj.connections.length; i++) {
			if (obj.connections[i].weight <= next.weight && obj.connections[i].relayID === r1) {
				next = obj.connections[i];

			}


		}
		list.push("R" + next.destRelayID);
		//Will need to change this to our real processing center ID
		if (next.destRelayID !== 11) {
			relayToRelay(next.destRelayID);
		}
	}
	//Give storeID to function startPath() to create the path to the processing center
	//startPath(1);
</script>